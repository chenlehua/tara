# TARA System 系统架构

## 概述

TARA System 是一个基于 AI 的汽车网络安全威胁分析与风险评估平台，符合 ISO/SAE 21434 标准。

## 架构图

```
┌─────────────────────────────────────────────────────────────────┐
│                        用户层 (User Layer)                        │
│                    Vue 3 + TypeScript Web App                    │
└─────────────────────────────────────────────────────────────────┘
                                │
                                ▼
┌─────────────────────────────────────────────────────────────────┐
│                       网关层 (Gateway Layer)                      │
│                         Nginx Reverse Proxy                      │
│              路由、负载均衡、SSL终结、速率限制                       │
└─────────────────────────────────────────────────────────────────┘
                                │
                                ▼
┌─────────────────────────────────────────────────────────────────┐
│                    业务服务层 (Service Layer)                      │
│  ┌──────────┐ ┌──────────┐ ┌──────────┐ ┌──────────┐           │
│  │ Project  │ │ Document │ │  Asset   │ │ Threat   │           │
│  │ Service  │ │ Service  │ │ Service  │ │ Service  │           │
│  │  :8001   │ │  :8002   │ │  :8003   │ │  :8004   │           │
│  └──────────┘ └──────────┘ └──────────┘ └──────────┘           │
│  ┌──────────┐ ┌──────────┐ ┌──────────┐                        │
│  │ Diagram  │ │  Report  │ │  Agent   │                        │
│  │ Service  │ │ Service  │ │ Service  │                        │
│  │  :8005   │ │  :8006   │ │  :8007   │                        │
│  └──────────┘ └──────────┘ └──────────┘                        │
└─────────────────────────────────────────────────────────────────┘
                                │
                                ▼
┌─────────────────────────────────────────────────────────────────┐
│                   AI Agent 层 (Agent Layer)                       │
│  ┌────────────────────────────────────────────────────────┐     │
│  │                    Agent Orchestrator                   │     │
│  │  ┌──────────┐ ┌──────────┐ ┌──────────┐ ┌──────────┐  │     │
│  │  │Document  │ │  Asset   │ │  Threat  │ │  Report  │  │     │
│  │  │ Agent    │ │  Agent   │ │  Agent   │ │  Agent   │  │     │
│  │  └──────────┘ └──────────┘ └──────────┘ └──────────┘  │     │
│  └────────────────────────────────────────────────────────┘     │
└─────────────────────────────────────────────────────────────────┘
                                │
                                ▼
┌─────────────────────────────────────────────────────────────────┐
│                   AI 模型层 (Model Layer)                         │
│  ┌──────────┐ ┌──────────┐ ┌──────────┐ ┌──────────┐           │
│  │  Qwen3   │ │ Qwen3-VL │ │Embedding │ │ OCRFlux  │           │
│  │  (LLM)   │ │  (VLM)   │ │  Model   │ │  (OCR)   │           │
│  └──────────┘ └──────────┘ └──────────┘ └──────────┘           │
│                    vLLM Inference Server                        │
└─────────────────────────────────────────────────────────────────┘
                                │
                                ▼
┌─────────────────────────────────────────────────────────────────┐
│                     数据层 (Data Layer)                          │
│  ┌──────────┐ ┌──────────┐ ┌──────────┐ ┌──────────┐           │
│  │  MySQL   │ │  Redis   │ │  Neo4j   │ │  Milvus  │           │
│  │  (主库)   │ │  (缓存)   │ │ (图数据库)│ │ (向量库)  │           │
│  └──────────┘ └──────────┘ └──────────┘ └──────────┘           │
│  ┌──────────┐ ┌──────────┐                                      │
│  │   ES     │ │  MinIO   │                                      │
│  │ (搜索)   │ │ (对象存储) │                                      │
│  └──────────┘ └──────────┘                                      │
└─────────────────────────────────────────────────────────────────┘
```

## 服务说明

### 业务服务

| 服务 | 端口 | 职责 |
|------|------|------|
| Project Service | 8001 | 项目管理、配置管理 |
| Document Service | 8002 | 文档上传、解析、OCR |
| Asset Service | 8003 | 资产识别、图谱管理 |
| Threat-Risk Service | 8004 | STRIDE分析、风险评估 |
| Diagram Service | 8005 | 图表生成 |
| Report Service | 8006 | 报告生成、导出 |
| Agent Service | 8007 | AI Agent、对话 |

### AI Agent

| Agent | 功能 |
|-------|------|
| Document Agent | 文档解析、结构提取 |
| Asset Agent | 资产发现、关系识别 |
| Threat Agent | 威胁分析、风险评估 |
| Report Agent | 报告撰写、内容生成 |

### 数据存储

| 存储 | 用途 |
|------|------|
| MySQL | 关系型业务数据 |
| Redis | 缓存、会话、任务队列 |
| Neo4j | 资产关系图谱 |
| Milvus | 向量存储、语义搜索 |
| Elasticsearch | 全文搜索 |
| MinIO | 文件对象存储 |

## 技术栈

### 前端
- Vue 3 + TypeScript
- Pinia (状态管理)
- Element Plus + TailwindCSS
- ECharts + D3.js (可视化)

### 后端
- Python 3.11+
- FastAPI
- SQLAlchemy
- Celery + Redis

### AI
- vLLM (推理框架)
- LangChain (Agent框架)
- Qwen 系列模型

## 部署架构

### Docker Compose (开发/测试)
```bash
docker compose up -d
```

### Kubernetes (生产)
```bash
kubectl apply -k deploy/k8s/overlays/prod
```

## 安全设计

1. **认证**: JWT Token 认证
2. **授权**: RBAC 权限控制
3. **通信**: TLS/HTTPS 加密
4. **数据**: 敏感数据加密存储
5. **审计**: 操作日志记录
