# TARA 工作流详解

本文档详细介绍 TARA (Threat Analysis and Risk Assessment) 工作流程。

## 工作流概览

```
┌──────────────┐    ┌──────────────┐    ┌──────────────┐    ┌──────────────┐
│  文档解析     │ →  │  资产识别     │ →  │  威胁分析     │ →  │  报告生成     │
│  Phase 1     │    │  Phase 2     │    │  Phase 3     │    │  Phase 4     │
└──────────────┘    └──────────────┘    └──────────────┘    └──────────────┘
```

## Phase 1: 文档解析

### 目标
从技术文档中提取系统架构和安全相关信息。

### 输入
- 系统设计文档 (SDD)
- 软件架构文档
- 网络拓扑图
- 接口规范
- 需求规格

### 处理步骤

1. **文档上传**
   - 支持 PDF、Word、Excel 格式
   - 支持批量上传

2. **OCR 处理** (如需要)
   - 扫描文档文字识别
   - 图表内容提取

3. **结构分析**
   - 识别文档章节
   - 提取标题层级
   - 识别表格和列表

4. **内容提取**
   - 系统组件识别
   - 接口信息提取
   - 数据流识别

### 输出
- 结构化文档内容
- 组件列表
- 接口定义
- 数据流描述

## Phase 2: 资产识别

### 目标
识别所有需要保护的网络安全资产。

### 资产类型

| 类型 | 说明 | 示例 |
|------|------|------|
| ECU | 电子控制单元 | 发动机ECU、车身控制器 |
| 网关 | 网络网关 | 中央网关、域控制器 |
| 总线 | 通信总线 | CAN、LIN、Ethernet |
| 传感器 | 感知设备 | 摄像头、雷达、激光雷达 |
| 执行器 | 控制设备 | 电机、阀门 |
| 外部接口 | 对外接口 | OBD、蓝牙、WiFi |
| 数据 | 数据资产 | 密钥、配置、个人信息 |
| 功能 | 功能资产 | 远程启动、OTA更新 |

### 安全属性 (CIA)

为每个资产评估：

- **机密性 (C)**: 数据不被未授权访问
- **完整性 (I)**: 数据不被未授权修改
- **可用性 (A)**: 服务持续可用

等级：低 / 中 / 高

### 损害场景

识别资产被破坏时的损害：

| 维度 | 说明 |
|------|------|
| 安全影响 (S) | 对人身安全的影响 |
| 财务影响 (F) | 直接经济损失 |
| 运营影响 (O) | 对功能可用性的影响 |
| 隐私影响 (P) | 对个人隐私的影响 |

### 资产关系

建立资产间的关系：

- `CONNECTS_TO`: 网络连接
- `SENDS_DATA_TO`: 数据传输
- `CONTROLS`: 控制关系
- `AUTHENTICATES`: 认证关系

## Phase 3: 威胁分析

### STRIDE 威胁建模

对每个资产应用 STRIDE 方法：

| 类型 | 违反属性 | 示例威胁 |
|------|----------|----------|
| Spoofing | 真实性 | 伪造 CAN 消息 |
| Tampering | 完整性 | 篡改固件 |
| Repudiation | 不可否认性 | 否认恶意操作 |
| Information Disclosure | 机密性 | 泄露密钥 |
| Denial of Service | 可用性 | CAN 总线洪泛 |
| Elevation of Privilege | 授权 | 绕过诊断认证 |

### 攻击路径分析

构建攻击树：

```
[目标] 获取车辆控制权
    ├─ [AND] 远程攻击
    │   ├─ 入侵云服务
    │   └─ 下发恶意命令
    └─ [OR] 本地攻击
        ├─ OBD 接口攻击
        └─ 无线接口攻击
```

### 攻击可行性评估

根据 ISO/SAE 21434 评估攻击潜力：

| 因素 | 评分范围 | 说明 |
|------|----------|------|
| 专业知识 | 0-8 | 攻击者所需专业水平 |
| 时间消耗 | 0-5 | 实施攻击所需时间 |
| 设备要求 | 0-6 | 所需设备复杂度 |
| 知识获取 | 0-7 | 所需内部知识 |
| 机会窗口 | 0-4 | 攻击机会窗口 |

**攻击潜力 = Σ(因素评分)**

| 攻击潜力 | 可行性等级 |
|----------|------------|
| 0-9 | 非常高 |
| 10-13 | 高 |
| 14-19 | 中 |
| 20-24 | 低 |
| ≥25 | 非常低 |

### 风险计算

**风险 = 影响 × 可能性**

风险矩阵：

|       | 低 | 中 | 高 | 非常高 |
|-------|-----|-----|-----|-------|
| 严重   | 高 | 严重 | 严重 | 严重 |
| 重大   | 中 | 高 | 严重 | 严重 |
| 中等   | 低 | 中 | 高 | 严重 |
| 轻微   | 可忽略 | 低 | 中 | 高 |
| 可忽略 | 可忽略 | 可忽略 | 低 | 中 |

### 控制措施推荐

针对每个威胁推荐控制措施：

- 预防性控制
- 检测性控制
- 纠正性控制
- 威慑性控制

## Phase 4: 报告生成

### 报告结构 (ISO/SAE 21434)

1. 执行摘要
2. 范围定义
3. 对象定义
4. 资产识别
5. 威胁场景识别
6. 影响评估
7. 攻击路径分析
8. 攻击可行性评估
9. 风险确定
10. 风险处置决策
11. 网络安全目标
12. 网络安全要求
13. 附录

### 导出格式

- PDF: 正式报告
- Word: 可编辑文档
- Excel: 数据表格

## 最佳实践

1. **完整性**: 覆盖所有资产和威胁
2. **一致性**: 使用统一的评估标准
3. **可追溯性**: 建立威胁到控制措施的追溯
4. **迭代更新**: 定期审查和更新分析
5. **团队协作**: 多人协作审核结果
